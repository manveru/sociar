<div id="message">
  <h1>Message Center</h1>

  <h2><a onclick="return $('#send').toggle(500);">Send a message</a></h2>

  <div id="send">
    <form method="post" action="/message" name="message/send">
      <fieldset>
        <legend>Send a Message</legend>

        <label for="login">To:</label>
        <input type="text" name="login" id="login"
          onfocus="$(this).autocomplete({ajax_get:message, minchars: 1, autowidth:true})"
        />
        <div class="clearfix"></div>
        #{ form_text('Subject', :subject, @message.subject) }
        #{ form_textarea('Message', :body, @message.body) }

        <input type="submit" value="Send" />
      </fieldset>
    </form>

    <script>$('#send').hide();</script>
  </div>

  <div id="history">
    <h2>Received</h2>
    <?r if @received.each{|message| ?>
      <div class="message">
        <div class="from">From: #{message.from.name_linked}</div>
        <div class="subject">Subject: #{h message.subject}</div>
        <div class="body">#{h message.body}</div>
      </div>
    <?r }.empty? ?>
      You have not received any messages yet
    <?r end ?>

    <h2>Sent</h2>
    <?r if @sent.each{|message| ?>
      <div class="message">
        <div class="to">To: #{message.to.name_linked}</div>
        <div class="subject">Subject: #{h message.subject}</div>
        <div class="body">#{h message.body}</div>
      </div>
    <?r }.empty? ?>
      You have not sent any messages yet
    <?r end ?>
  </div>
</div>
